name: Freqtrade-Gemini-Sniper
on:
  workflow_dispatch:
jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install Dependencies
        run: |
          sudo apt-get update && sudo apt-get install -y build-essential wget
          wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
          tar -xzf ta-lib-0.4.0-src.tar.gz
          cd ta-lib/ && ./configure --prefix=/usr && make && sudo make install
          cd ..
          pip install TA-Lib freqtrade
      - name: Create Strategy & Config
        run: |
          freqtrade create-userdir --userdir user_data
          # استراتيجية Gemini Sniper المبتكرة
          cat <<EOF > user_data/strategies/GeminiSniper.py
          from freqtrade.strategy import IStrategy
          import talib.abstract as ta
          from pandas import DataFrame

          class GeminiSniper(IStrategy):
              timeframe = '15m'
              stoploss = -0.05  # وقف خسارة قاسي 5% لحماية محفظتك
              minimal_roi = {"0": 0.03, "30": 0.01} # بيع عند ربح 3% فوراً أو 1% بعد نص ساعة

              def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
                  # MACD بإعداداتك المفضلة
                  macd = ta.MACD(dataframe, fastperiod=6, slowperiod=16, signalperiod=9)
                  dataframe['macd'] = macd['macd']
                  dataframe['macdsignal'] = macd['macdsignal']
                  
                  # RSI لمعرفة قوة الزخم
                  dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)
                  
                  # EMA 50 لتحديد الاتجاه العام
                  dataframe['ema50'] = ta.EMA(dataframe, timeperiod=50)
                  return dataframe

              def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
                  dataframe.loc[
                      (
                          (dataframe['macd'] > dataframe['macdsignal']) & # تقاطع ماكد صاعد
                          (dataframe['rsi'] > 50) &                       # زخم قوي
                          (dataframe['close'] > dataframe['ema50'])       # السعر فوق المتوسط (تريند صاعد)
                      ),
                      'enter_long'] = 1
                  return dataframe

              def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
                  dataframe.loc[
                      (
                          (dataframe['macd'] < dataframe['macdsignal']) | # تقاطع ماكد هابط
                          (dataframe['close'] < dataframe['ema50'])       # كسر التريند لتحت
                      ),
                      'exit_long'] = 1
                  return dataframe
          EOF
          # الإعدادات: 10 دولار، 300 عملة، تليجرام مفعل بالكامل
          cat <<EOF > user_data/config.json
          {
              "max_open_trades": 5,
              "stake_currency": "USDT",
              "stake_amount": 10,
              "dry_run": true,
              "dry_run_wallet": 1000,
              "exchange": {
                  "name": "gateio",
                  "pair_whitelist": [".*/USDT"]
              },
              "pairlists": [
                  {
                      "method": "VolumePairList",
                      "number_assets": 300,
                      "sort_key": "quoteVolume",
                      "refresh_period": 1800
                  }
              ],
              "entry_pricing": {"price_side": "same", "use_order_book": true},
              "exit_pricing": {"price_side": "same", "use_order_book": true},
              "telegram": {
                  "enabled": true,
                  "token": "8575558875:AAEK-jcmG5NF1NJGKdq3XHZ4XPcZxjvbtNo",
                  "chat_id": "978554149",
                  "force_entry_enable": true,
                  "force_exit_enable": true
              }
          }
          EOF
          freqtrade trade --config user_data/config.json --strategy GeminiSniper --userdir user_data --dry-run
