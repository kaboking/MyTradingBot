name: AbuBatta-Live-Bot
on:
  workflow_dispatch:
jobs:
  trade:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential wget
          wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
          tar -xzf ta-lib-0.4.0-src.tar.gz
          cd ta-lib/ && ./configure --prefix=/usr && make && sudo make install
          cd ..
      - name: Install Freqtrade
        run: |
          pip install --upgrade pip
          pip install TA-Lib freqtrade
      - name: Create Config and Run
        run: |
          # كتابة ملف الإعدادات ببياناتك الحقيقية اللي بعتها
          cat <<EOF > config.json
          {
              "max_open_trades": 3,
              "stake_currency": "USDT",
              "stake_amount": "0.05",
              "tradable_balance_ratio": 0.99,
              "last_stake_amount_min_ratio": 0.5,
              "fiat_display_currency": "USD",
              "timeframe": "5m",
              "dry_run": true,
              "dry_run_wallet": 1000,
              "stake_amount_type": "fixed",
              "exchange": {
                  "name": "binance",
                  "key": "",
                  "secret": "",
                  "pair_whitelist": ["BTC/USDT", "ETH/USDT"],
                  "pair_blacklist": []
              },
              "telegram": {
                  "enabled": true,
                  "token": "8575558875:AAEK-jcmG5NF1NJGKdq3XHZ4XPcZxjvbtNo",
                  "chat_id": "978554149"
              }
          }
          EOF
          # تشغيل البوت مع البحث عن الاستراتيجية
          STRAT_PATH=$(find . -name "SampleStrategy.py" | head -n 1)
          if [ -z "$STRAT_PATH" ]; then
            echo "تحذير: مش لاقي ملف الاستراتيجية، هستخدم الافتراضية"
            freqtrade trade --config config.json --dry-run
          else
            freqtrade trade --config config.json --strategy SampleStrategy --dry-run
          fi
