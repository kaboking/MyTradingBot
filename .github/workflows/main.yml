name: Freqtrade Dry Run Bot

on:
  workflow_dispatch:   # شغله يدوي من Actions tab
  # push:              # لو عايز يشتغل مع كل push، شيل التعليق
  #   branches: [ main ]

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Freqtrade
        run: |
          pip install --upgrade pip
          pip install freqtrade

      - name: Create user_data and config
        run: |
          mkdir -p user_data/strategies
          freqtrade create-userdir --userdir user_data || true
          
          cat > user_data/config.json << EOF
          {
              "max_open_trades": 3,
              "stake_currency": "USDT",
              "stake_amount": "unlimited",
              "dry_run": true,
              "dry_run_wallet": 1000,
              "timeframe": "5m",
              "exchange": {
                  "name": "binance",
                  "key": "",
                  "secret": "",
                  "pair_whitelist": ["BTC/USDT", "ETH/USDT"]
              }
          }
          EOF

          cat > user_data/strategies/Sample.py << EOF
          from freqtrade.strategy import IStrategy
          class Sample(IStrategy):
              INTERFACE_VERSION = 3
              minimal_roi = {"0": 0.1}
              stoploss = -0.1
              timeframe = '5m'
              def populate_indicators(self, dataframe, metadata): return dataframe
              def populate_entry_trend(self, dataframe, metadata):
                  dataframe['enter_long'] = 1
                  return dataframe
              def populate_exit_trend(self, dataframe, metadata):
                  dataframe['exit_long'] = 1
                  return dataframe
          EOF

      - name: Run Freqtrade Dry Run
        run: |
          freqtrade trade --config user_data/config.json --strategy Sample --userdir user_data --dry-run
