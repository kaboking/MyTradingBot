# خطوة 1: تأكد إنك في root المشروع (المفروض تكون كده أصلاً بعد checkout)
pwd

# خطوة 2: أنشئ المجلد يدويًا + subfolders عشان نضمن ما يحصلش أي permission أو path error
mkdir -p user_data
mkdir -p user_data/strategies
mkdir -p user_data/data/binance
mkdir -p user_data/logs
mkdir -p user_data/backtest_results
mkdir -p user_data/hyperopt_results
mkdir -p user_data/plot

# خطوة 3: شغل create-userdir (ده هيحاول ينشئ الهيكل الداخلي، ولو فشل مش مشكلة لأننا عملناه يدويًا)
freqtrade create-userdir --userdir user_data || echo "create-userdir خلص أو مش ضروري، المجلدات موجودة"

# خطوة 4: أنشئ config.json بسيط (dry-run + بدون API keys حساسة)
cat > user_data/config.json << 'EOF'
{
    "max_open_trades": 3,
    "stake_currency": "USDT",
    "stake_amount": "unlimited",
    "tradable_balance_ratio": 0.99,
    "fiat_display_currency": "USD",
    "timeframe": "5m",
    "dry_run": true,
    "dry_run_wallet": 1000,
    "exchange": {
        "name": "binance",
        "key": "",
        "secret": "",
        "pair_whitelist": ["BTC/USDT", "ETH/USDT"],
        "pair_blacklist": []
    },
    "telegram": {
        "enabled": true,
        "token": "8575558875:AAEK-jcmG5NF1NJGKdq3XHZ4XPcZxjvbtNo",
        "chat_id": "978554149"
    }
}
EOF

# خطوة 5: أنشئ استراتيجية بسيطة جدًا عشان ما يطلعش خطأ "no strategy"
cat > user_data/strategies/SampleStrategy.py << 'EOF'
from freqtrade.strategy import IStrategy
from pandas import DataFrame

class SampleStrategy(IStrategy):
    INTERFACE_VERSION = 3

    minimal_roi = {"0": 0.1}
    stoploss = -0.10
    timeframe = '5m'

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        return dataframe

    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[:, 'enter_long'] = 1
        dataframe.loc[:, 'enter_tag'] = 'buy_signal'
        return dataframe

    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[:, 'exit_long'] = 1
        dataframe.loc[:, 'exit_tag'] = 'sell_signal'
        return dataframe
EOF

# خطوة 6: شغل البوت أخيرًا مع تحديد --userdir صراحة
freqtrade trade \
  --config user_data/config.json \
  --strategy SampleStrategy \
  --userdir user_data \
  --dry-run \
  --logfile user_data/logs/freqtrade.log
